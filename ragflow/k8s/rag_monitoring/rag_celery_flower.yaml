apiVersion: apps/v1
kind: Deployment
metadata:
  name: rag-monitor
  labels:
    deployment: rag-monitor
spec:
  replicas: 1
  selector:
    matchLabels:
      pod: rag-monitor
  template:
    metadata:
      labels:
        pod: rag-monitor
    spec:
      serviceAccountName: k8s-service-account
      containers:
      - name: flower
        image: us-central1-docker.pkg.dev/sab-llm-hack-sbx-6315/gcf-artifacts/ragpipeline:v1
        command: ['celery', "--broker=redis://celery-redis:6379/0" , "flower"]
        ports:
          - containerPort: 5555
        env:
            - name: REDIS_SERVER
              value: "celery-redis:6379/0"
            - name: PDF_BATCH_SIZE
              value: "10"
            - name: GCS_BUCKET
              value: "synxis-src"
            - name: VECTOR_HOST
              value: "127.0.0.1"
            - name: VECTOR_PORT
              value: "5432"
            - name: VECTOR_USER
              value: "postgres"
            - name: VECTOR_PWD
              value: "sUmmertime123$"
            - name: VECTOR_DB
              value: "synxis-db"
            - name: VECTOR_COLLECTIONS
              value: "sabre_vector_synxis"
            - name: NFS_MOUNT
              value: "/ragspersistentstore"
        resources:
          limits:
            cpu: 100m
